#!/usr/bin/env python3
"""
–ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞ - —É–±–∏—Ä–∞–µ–º –¥–µ–º–æ –¥–∞–Ω–Ω—ã–µ
"""

import requests
import json
import time

def test_server_demo_data():
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ –¥–µ–º–æ –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ"""
    print("üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–µ–º–æ –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ...")
    
    try:
        # –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–±–æ—Ä —Ä–∏–ª—Å–æ–≤
        response = requests.post(
            "http://72.56.66.228/api/trends/collect-reels",
            json={
                "competitors": ["rem.vac"],
                "count": 3
            },
            headers={'Content-Type': 'application/json'},
            timeout=30
        )
        
        if response.status_code == 200:
            data = response.json()
            if data.get('success'):
                reels = data.get('reels', [])
                if reels:
                    first_reel = reels[0]
                    caption = first_reel.get('caption', '')
                    
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏–∑–Ω–∞–∫–∏ –¥–µ–º–æ –¥–∞–Ω–Ω—ã—Ö
                    demo_indicators = [
                        '–¥–µ–º–æ', 'demo', '–î–ï–ú–û', 'DEMO',
                        '–ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞',
                        '21.01.1970',
                        'demo_'
                    ]
                    
                    is_demo = any(indicator in caption.lower() for indicator in demo_indicators)
                    
                    if is_demo:
                        print("‚ùå –ù–ê –°–ï–†–í–ï–†–ï –î–ï–ú–û –î–ê–ù–ù–´–ï!")
                        print(f"   –ü—Ä–∏–º–µ—Ä: {caption[:100]}...")
                        return True
                    else:
                        print("‚úÖ –ù–ê –°–ï–†–í–ï–†–ï –†–ï–ê–õ–¨–ù–´–ï –î–ê–ù–ù–´–ï!")
                        print(f"   –ü—Ä–∏–º–µ—Ä: {caption[:100]}...")
                        return False
                else:
                    print("‚ö†Ô∏è –°–µ—Ä–≤–µ—Ä –Ω–µ –≤–µ—Ä–Ω—É–ª –¥–∞–Ω–Ω—ã—Ö")
                    return None
            else:
                print(f"‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: {data.get('message', 'Unknown error')}")
                return None
        else:
            print(f"‚ùå HTTP –æ—à–∏–±–∫–∞: {response.status_code}")
            return None
            
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: {e}")
        return None

def show_update_instructions():
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é"""
    print("\n" + "="*60)
    print("üîß –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –£–ë–ò–†–ê–ù–ò–Æ –î–ï–ú–û –î–ê–ù–ù–´–•")
    print("="*60)
    print()
    print("üìã –ü–†–û–ë–õ–ï–ú–ê: –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ 72.56.66.228 –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –¥–µ–º–æ –¥–∞–Ω–Ω—ã–µ")
    print("üéØ –†–ï–®–ï–ù–ò–ï: –ó–∞–º–µ–Ω–∏—Ç—å app.py –Ω–∞ –≤–µ—Ä—Å–∏—é –±–µ–∑ –¥–µ–º–æ –¥–∞–Ω–Ω—ã—Ö")
    print()
    print("üöÄ –ë–´–°–¢–†–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï:")
    print("1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É: ssh user@72.56.66.228")
    print("2. –°–¥–µ–ª–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é: cp app.py app_backup.py")
    print("3. –ó–∞–º–µ–Ω–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ app.py –Ω–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ app_fixed_elevenlabs.py")
    print("4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ: pkill -f python && python3 app.py")
    print()
    print("üìÅ –§–ê–ô–õ–´ –î–õ–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø:")
    print("‚úÖ app_fixed_elevenlabs.py - –í–ï–†–°–ò–Ø –ë–ï–ó –î–ï–ú–û –î–ê–ù–ù–´–•")
    print("‚úÖ API_SETUP_GUIDE.md - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ")
    print("‚úÖ test_api_endpoints.py - –¢–µ—Å—Ç endpoints")
    print()
    print("üîç –ü–†–û–í–ï–†–ö–ê –ü–û–°–õ–ï –û–ë–ù–û–í–õ–ï–ù–ò–Ø:")
    print("1. –û—Ç–∫—Ä–æ–π—Ç–µ http://72.56.66.228/module/trends")
    print("2. –ù–∞–∂–º–∏—Ç–µ '–°–æ–±—Ä–∞—Ç—å —Ä–∏–ª—Å—ã –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤'")
    print("3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–µ—Ç '–î–µ–º–æ-–ø–æ—Å—Ç' –∏ –¥–∞—Ç '21.01.1970'")
    print()
    print("‚ö†Ô∏è –í–ê–ñ–ù–û:")
    print("- –°–¥–µ–ª–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –ø–µ—Ä–µ–¥ –∑–∞–º–µ–Ω–æ–π")
    print("- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Apify API –∫–ª—é—á –Ω–∞—Å—Ç—Ä–æ–µ–Ω")
    print("- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è")

def main():
    print("üöÄ –ü–†–û–í–ï–†–ö–ê –î–ï–ú–û –î–ê–ù–ù–´–• –ù–ê –°–ï–†–í–ï–†–ï")
    print("="*50)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–µ–º–æ –¥–∞–Ω–Ω—ã–µ
    has_demo = test_server_demo_data()
    
    if has_demo is True:
        print("\n‚ùå –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û: –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–µ–º–æ –¥–∞–Ω–Ω—ã–µ!")
        show_update_instructions()
    elif has_demo is False:
        print("\n‚úÖ –û–¢–õ–ò–ß–ù–û: –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ!")
        print("üéâ –î–µ–º–æ –¥–∞–Ω–Ω—ã–µ —É–∂–µ —É–±—Ä–∞–Ω—ã!")
    else:
        print("\n‚ö†Ô∏è –ù–ï –£–î–ê–õ–û–°–¨ –ü–†–û–í–ï–†–ò–¢–¨ –°–ï–†–í–ï–†")
        print("üîß –í–æ–∑–º–æ–∂–Ω–æ, —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å API")
        show_update_instructions()

if __name__ == "__main__":
    main()
