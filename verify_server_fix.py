#!/usr/bin/env python3
"""
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è - —É–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –¥–µ–º–æ –¥–∞–Ω–Ω—ã–µ —É–±—Ä–∞–Ω—ã
"""

import requests
import json
import time

def check_server_fix():
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –¥–µ–º–æ –¥–∞–Ω–Ω—ã–µ —É–±—Ä–∞–Ω—ã —Å —Å–µ—Ä–≤–µ—Ä–∞"""
    print("üîç –ü–†–û–í–ï–†–ö–ê –°–ï–†–í–ï–†–ê –ü–û–°–õ–ï –û–ë–ù–û–í–õ–ï–ù–ò–Ø")
    print("="*50)
    
    try:
        print("üì° –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É...")
        
        # –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–±–æ—Ä —Ä–∏–ª—Å–æ–≤
        response = requests.post(
            "http://72.56.66.228/api/trends/collect-reels",
            json={
                "competitors": ["rem.vac"],
                "count": 5
            },
            headers={'Content-Type': 'application/json'},
            timeout=30
        )
        
        print(f"üìä –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: {response.status_code}")
        
        if response.status_code == 200:
            data = response.json()
            print(f"‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç: {data.get('success', False)}")
            
            if data.get('success'):
                reels = data.get('reels', [])
                print(f"üìã –ü–æ–ª—É—á–µ–Ω–æ —Ä–∏–ª—Å–æ–≤: {len(reels)}")
                
                if reels:
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–≤—ã–π —Ä–∏–ª—Å
                    first_reel = reels[0]
                    caption = first_reel.get('caption', '')
                    date = first_reel.get('timestamp', '')
                    source = first_reel.get('source_username', '')
                    
                    print(f"\nüîç –ê–ù–ê–õ–ò–ó –ü–ï–†–í–û–ì–û –†–ò–õ–°–ê:")
                    print(f"   –ò—Å—Ç–æ—á–Ω–∏–∫: @{source}")
                    print(f"   –û–ø–∏—Å–∞–Ω–∏–µ: {caption[:100]}...")
                    print(f"   –î–∞—Ç–∞: {date}")
                    
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏–∑–Ω–∞–∫–∏ –¥–µ–º–æ –¥–∞–Ω–Ω—ã—Ö
                    demo_indicators = [
                        '–¥–µ–º–æ', 'demo', '–î–ï–ú–û', 'DEMO',
                        '–ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞',
                        '21.01.1970',
                        'demo_'
                    ]
                    
                    is_demo = any(indicator in caption.lower() for indicator in demo_indicators)
                    is_old_date = '1970' in str(date)
                    
                    if is_demo or is_old_date:
                        print("\n‚ùå –û–®–ò–ë–ö–ê: –î–ï–ú–û –î–ê–ù–ù–´–ï –í–°–ï –ï–©–ï –ï–°–¢–¨!")
                        print("üîß –°–µ—Ä–≤–µ—Ä –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ")
                        return False
                    else:
                        print("\n‚úÖ –û–¢–õ–ò–ß–ù–û: –î–ï–ú–û –î–ê–ù–ù–´–ï –£–ë–†–ê–ù–´!")
                        print("üéâ –°–µ—Ä–≤–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ")
                        return True
                else:
                    print("\n‚ö†Ô∏è –°–µ—Ä–≤–µ—Ä –Ω–µ –≤–µ—Ä–Ω—É–ª —Ä–∏–ª—Å–æ–≤")
                    print("üîß –í–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–æ–±–ª–µ–º–∞ —Å Apify API")
                    return None
            else:
                print(f"\n‚ùå –û—à–∏–±–∫–∞ API: {data.get('message', 'Unknown error')}")
                return False
        else:
            print(f"\n‚ùå HTTP –æ—à–∏–±–∫–∞: {response.status_code}")
            print(f"   –û—Ç–≤–µ—Ç: {response.text[:200]}")
            return False
            
    except requests.exceptions.Timeout:
        print("\n‚è∞ –¢–ê–ô–ú–ê–£–¢: –°–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç")
        print("üîß –í–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω–æ")
        return None
    except requests.exceptions.ConnectionError:
        print("\nüîå –û–®–ò–ë–ö–ê –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø: –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω")
        print("üîß –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω")
        return None
    except Exception as e:
        print(f"\n‚ùå –ù–ï–û–ñ–ò–î–ê–ù–ù–ê–Ø –û–®–ò–ë–ö–ê: {e}")
        return None

def show_next_steps(is_fixed):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞"""
    print("\n" + "="*60)
    
    if is_fixed is True:
        print("üéâ –°–ï–†–í–ï–† –£–°–ü–ï–®–ù–û –û–ë–ù–û–í–õ–ï–ù!")
        print("="*60)
        print()
        print("‚úÖ –î–µ–º–æ –¥–∞–Ω–Ω—ã–µ —É–±—Ä–∞–Ω—ã")
        print("‚úÖ –†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç Apify API")
        print("‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é")
        print()
        print("üöÄ –ß–¢–û –î–ê–õ–¨–®–ï:")
        print("1. –û—Ç–∫—Ä–æ–π—Ç–µ http://72.56.66.228/module/trends")
        print("2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ API –∫–ª—é—á–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ API'")
        print("3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–æ–ª–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω")
        print("4. –ù–∞—á–Ω–∏—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç!")
        
    elif is_fixed is False:
        print("‚ùå –°–ï–†–í–ï–† –ù–ï –û–ë–ù–û–í–õ–ï–ù!")
        print("="*60)
        print()
        print("üîß –ß–¢–û –ù–£–ñ–ù–û –°–î–ï–õ–ê–¢–¨:")
        print("1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É: ssh user@72.56.66.228")
        print("2. –ó–∞–º–µ–Ω–∏—Ç–µ app.py –Ω–∞ app_for_server.py")
        print("3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ")
        print("4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç —Ç–µ—Å—Ç —Å–Ω–æ–≤–∞")
        print()
        print("üìÅ –§–ê–ô–õ–´ –î–õ–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø:")
        print("‚úÖ app_for_server.py - –í–ï–†–°–ò–Ø –ë–ï–ó –î–ï–ú–û –î–ê–ù–ù–´–•")
        print("‚úÖ SERVER_DEMO_FIX_INSTRUCTIONS.md - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è")
        
    else:
        print("‚ö†Ô∏è –ù–ï –£–î–ê–õ–û–°–¨ –ü–†–û–í–ï–†–ò–¢–¨ –°–ï–†–í–ï–†")
        print("="*60)
        print()
        print("üîß –í–û–ó–ú–û–ñ–ù–´–ï –ü–†–ò–ß–ò–ù–´:")
        print("1. –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω")
        print("2. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω–æ")
        print("3. –ü—Ä–æ–±–ª–µ–º—ã —Å API")
        print()
        print("üöÄ –ß–¢–û –î–ï–õ–ê–¢–¨:")
        print("1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞")
        print("2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ")
        print("3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: tail -f app.log")

def main():
    print("üöÄ –ü–†–û–í–ï–†–ö–ê –û–ë–ù–û–í–õ–ï–ù–ò–Ø –°–ï–†–í–ï–†–ê")
    print("–£–±–∏—Ä–∞–µ–º –¥–µ–º–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ –º–æ–¥—É–ª—è —Ç—Ä–µ–Ω–¥–æ–≤")
    print()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Ä–≤–µ—Ä
    is_fixed = check_server_fix()
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏
    show_next_steps(is_fixed)
    
    print("\n" + "="*60)
    print("üìû –ï–°–õ–ò –í–û–ó–ù–ò–ö–ù–£–¢ –ü–†–û–ë–õ–ï–ú–´:")
    print("1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SERVER_DEMO_FIX_INSTRUCTIONS.md")
    print("2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª app.py –∑–∞–º–µ–Ω–µ–Ω")
    print("3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–æ")
    print("4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö")

if __name__ == "__main__":
    main()
