{% extends "base.html" %}

{% block title %}–ú–æ–¥—É–ª—å –¢—Ä–µ–Ω–¥–≤–æ—Ç—á–∏–Ω–≥–∞ - –ö–æ–Ω—Ç–µ–Ω—Ç –ó–∞–≤–æ–¥{% endblock %}

{% block extra_head %}
<script>
// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º–∏

async function loadCompetitors() {
    console.log('üîÑ –ó–ê–ì–†–£–ó–ö–ê –ö–û–ù–ö–£–†–ï–ù–¢–û–í - –ù–ê–ß–ê–õ–û');
    const container = document.getElementById('competitorsList');
    const countEl = document.getElementById('competitorsCount');
    
    if (!container) {
        console.error('‚ùå –≠–ª–µ–º–µ–Ω—Ç competitorsList –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
    }
    
    container.innerHTML = `
        <div class="text-center text-primary p-3">
            <div class="spinner-border spinner-border-sm me-2" role="status"></div>
            <span>–ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤...</span>
        </div>`;
    
    try {
        console.log('üì° –û–¢–ü–†–ê–í–õ–Ø–ï–ú –ó–ê–ü–†–û–° –ö /api/competitors');
        const response = await fetch('/api/competitors');
        console.log('üì° –û–¢–í–ï–¢ –ü–û–õ–£–ß–ï–ù:', response.status);
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
        }
        
        const competitors = await response.json();
        console.log('üìä –î–ê–ù–ù–´–ï –ü–û–õ–£–ß–ï–ù–´:', competitors.length);

        if (!Array.isArray(competitors) || competitors.length === 0) {
            container.innerHTML = `
                <div class="text-center text-muted p-3">
                    <i class="fas fa-users fa-2x mb-2 text-muted"></i>
                    <div>–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</div>
                </div>`;
            if (countEl) countEl.textContent = '0';
            return;
        }

        console.log('‚úÖ –†–ï–ù–î–ï–†–ò–ú –°–ü–ò–°–û–ö –ö–û–ù–ö–£–†–ï–ù–¢–û–í –í –°–¢–ò–õ–ï EXCEL');
        container.innerHTML = `
            <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                <table class="table table-sm table-bordered table-hover mb-0" style="font-size: 14px;">
                    <thead class="table-dark sticky-top">
                        <tr>
                            <th width="40" class="text-center">
                                <input type="checkbox" id="selectAll" onchange="toggleAllCompetitors()" class="form-check-input">
                            </th>
                            <th width="60" class="text-center">‚Ññ</th>
                            <th>–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç</th>
                            <th width="100" class="text-center">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</th>
                            <th width="80" class="text-center">–°—Ç–∞—Ç—É—Å</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${competitors.map((comp, index) => `
                            <tr class="align-middle">
                                <td class="text-center">
                                    <input type="checkbox" value="${comp.username}" id="comp_${comp.id}" ${index === 0 ? 'checked' : ''} onchange="updateCompetitorCount()" class="form-check-input">
                                </td>
                                <td class="text-center fw-bold text-muted">${index + 1}</td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-user-circle me-2 text-primary"></i>
                                        <span class="fw-bold">@${comp.username}</span>
                                    </div>
                                </td>
                                <td class="text-center">
                                    <span class="badge bg-info">${comp.platform}</span>
                                </td>
                                <td class="text-center">
                                    <span class="badge bg-success">–ê–∫—Ç–∏–≤–µ–Ω</span>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        `;
        
        if (countEl) countEl.textContent = competitors.length;
        
        console.log('‚úÖ –ö–û–ù–ö–£–†–ï–ù–¢–´ –ó–ê–ì–†–£–ñ–ï–ù–´ –£–°–ü–ï–®–ù–û:', competitors.length);
        
    } catch (error) {
        console.error('‚ùå –û–®–ò–ë–ö–ê:', error);
        container.innerHTML = `
            <div class="text-center text-danger p-3">
                <i class="fas fa-exclamation-triangle fa-2x mb-2"></i>
                <div>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>
                <small>${error.message}</small>
            </div>`;
        if (countEl) countEl.textContent = '0';
    }
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–∞–±–ª–∏—Ü–µ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
function toggleAllCompetitors() {
    const selectAll = document.getElementById('selectAll');
    const checkboxes = document.querySelectorAll('#competitorsList input[type="checkbox"]:not(#selectAll)');
    
    checkboxes.forEach(checkbox => {
        checkbox.checked = selectAll.checked;
    });
    
    updateCompetitorCount();
}

function updateCompetitorCount() {
    const checkedBoxes = document.querySelectorAll('#competitorsList input[type="checkbox"]:not(#selectAll):checked');
    const countEl = document.getElementById('competitorsCount');
    const selectAll = document.getElementById('selectAll');
    
    if (countEl) {
        countEl.textContent = checkedBoxes.length;
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ "–í—ã–±—Ä–∞—Ç—å –≤—Å–µ—Ö"
    if (selectAll) {
        const allBoxes = document.querySelectorAll('#competitorsList input[type="checkbox"]:not(#selectAll)');
        selectAll.checked = checkedBoxes.length === allBoxes.length;
        selectAll.indeterminate = checkedBoxes.length > 0 && checkedBoxes.length < allBoxes.length;
    }
}

// –§—É–Ω–∫—Ü–∏—è —Å–±–æ—Ä–∞ —Ä–∏–ª—Å–æ–≤ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º —Ç–∞–π–º–∞—É—Ç–æ–º
async function collectReels(event) {
    event.preventDefault();
    console.log('üé¨ –ù–ê–ß–ò–ù–ê–ï–ú –°–ë–û–† –†–ò–õ–°–û–í –ö–û–ù–ö–£–†–ï–ù–¢–û–í');
    
    const button = document.getElementById('collectButton');
    const statusDiv = document.getElementById('collectStatus');
    const reelsCount = document.getElementById('reelsCount').value;
    
    // –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
    const selectedCompetitors = [];
    const checkboxes = document.querySelectorAll('#competitorsList input[type="checkbox"]:not(#selectAll):checked');
    
    checkboxes.forEach(checkbox => {
        selectedCompetitors.push(checkbox.value);
    });
    
    if (selectedCompetitors.length === 0) {
        statusDiv.innerHTML = `
            <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle me-2"></i>
                –í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞
            </div>`;
        return;
    }
    
    console.log('üìä –í–´–ë–†–ê–ù–ù–´–ï –ö–û–ù–ö–£–†–ï–ù–¢–´:', selectedCompetitors);
    console.log('üìä –ö–û–õ–ò–ß–ï–°–¢–í–û –†–ò–õ–°–û–í:', reelsCount);
    
    // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å
    button.disabled = true;
    button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>–°–æ–±–∏—Ä–∞–µ–º —Ä–∏–ª—Å—ã...';
    
    statusDiv.innerHTML = `
        <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i>
            –ù–∞—á–∏–Ω–∞–µ–º —Å–±–æ—Ä —Ä–∏–ª—Å–æ–≤ –¥–ª—è ${selectedCompetitors.length} –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤...
            <br><small class="text-muted">–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç</small>
        </div>`;
    
    try {
        console.log('üì° –û–¢–ü–†–ê–í–õ–Ø–ï–ú –ó–ê–ü–†–û–° –ù–ê –°–ë–û–† –†–ò–õ–°–û–í');
        
        // –°–æ–∑–¥–∞–µ–º AbortController –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —Ç–∞–π–º–∞—É—Ç–∞
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 300000); // 5 –º–∏–Ω—É—Ç —Ç–∞–π–º–∞—É—Ç
        
        const response = await fetch('/api/trends/collect-reels', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                competitors: selectedCompetitors,
                reels_count: parseInt(reelsCount)
            }),
            signal: controller.signal
        });
        
        clearTimeout(timeoutId);
        console.log('üì° –û–¢–í–ï–¢ –ü–û–õ–£–ß–ï–ù:', response.status);
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const result = await response.json();
        console.log('üìä –†–ï–ó–£–õ–¨–¢–ê–¢ –°–ë–û–†–ê:', result);
        
        if (result.success) {
            statusDiv.innerHTML = `
                <div class="alert alert-success">
                    <i class="fas fa-check-circle me-2"></i>
                    –£—Å–ø–µ—à–Ω–æ —Å–æ–±—Ä–∞–Ω–æ ${result.total_count || result.total_reels || 0} —Ä–∏–ª—Å–æ–≤ –æ—Ç ${selectedCompetitors.length} –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
                    <br><small class="text-muted">–í–∏—Ä–∞–ª—å–Ω—ã—Ö: ${result.viral_count || 0}</small>
                </div>`;
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥
            activateStep2();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            updateReelsStats(result);
            
        } else {
            throw new Error(result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
        }
        
    } catch (error) {
        console.error('‚ùå –û–®–ò–ë–ö–ê –°–ë–û–†–ê –†–ò–õ–°–û–í:', error);
        
        let errorMessage = error.message;
        if (error.name === 'AbortError') {
            errorMessage = '–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è (5 –º–∏–Ω—É—Ç). –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É–º–µ–Ω—å—à–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∏–ª—Å–æ–≤.';
        }
        
        statusDiv.innerHTML = `
            <div class="alert alert-danger">
                <i class="fas fa-exclamation-triangle me-2"></i>
                –û—à–∏–±–∫–∞ —Å–±–æ—Ä–∞ —Ä–∏–ª—Å–æ–≤: ${errorMessage}
                <br><small class="text-muted">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É–º–µ–Ω—å—à–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∏–ª—Å–æ–≤ –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</small>
            </div>`;
    } finally {
        // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
        button.disabled = false;
        button.innerHTML = '<i class="fas fa-cloud-download-alt me-2"></i>–°–æ–±—Ä–∞—Ç—å —Ä–∏–ª—Å—ã –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤';
    }
}

// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ä–∏–ª—Å–æ–≤
function updateReelsStats(result) {
    const totalReels = document.getElementById('totalReels');
    const viralReels = document.getElementById('viralReels');
    
    if (totalReels) {
        totalReels.textContent = result.total_count || result.total_reels || 0;
    }
    
    if (viralReels) {
        viralReels.textContent = result.viral_count || 0;
    }
}

// –§—É–Ω–∫—Ü–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –≤—Ç–æ—Ä–æ–≥–æ —à–∞–≥–∞
function activateStep2() {
    const step2 = document.getElementById('step2');
    if (step2) {
        step2.classList.remove('step-disabled');
        step2.classList.add('step-active');
        console.log('‚úÖ –®–∞–≥ 2 –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
    }
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ (–∑–∞–≥–ª—É—à–∫–∏)
function sortByViews() {
    console.log('üìä –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞–º');
    // TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É
}

function sortByLikes() {
    console.log('üìä –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ª–∞–π–∫–∞–º');
    // TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É
}

// –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –∑–∞–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤');
    loadCompetitors();
});
</script>

<style>
    /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –±–ª–æ–∫–æ–≤-—à–∞–≥–æ–≤ */
    .progress-step {
        margin-bottom: 30px !important;
        box-shadow: 0 8px 32px rgba(0, 64, 39, 0.12) !important;
        border-radius: 16px !important;
        border: 1px solid rgba(0, 64, 39, 0.08) !important;
        transition: all 0.3s ease !important;
    }
    
    .progress-step:hover {
        box-shadow: 0 12px 40px rgba(0, 64, 39, 0.18) !important;
        transform: translateY(-2px) !important;
    }
    
    .progress-step.step-active {
        border-color: var(--gsr-accent) !important;
        box-shadow: 0 8px 32px rgba(39, 145, 52, 0.15) !important;
    }
    
    /* –û—Ç—Å—Ç—É–ø—ã –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
    .step-container {
        padding: 0 15px;
        margin-top: 40px; /* –û—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –∑–µ–ª–µ–Ω–æ–π –ø–ª–∞—à–∫–æ–π –∏ –±–ª–æ–∫–∞–º–∏ */
    }
    
    /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–æ–≤ */
    .progress-step .card-body,
    .progress-step {
        padding: 30px !important;
    }
    
    /* –ö—Ä–∞—Å–∏–≤—ã–µ —Ç–µ–Ω–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
    .btn-gsr-accent {
        box-shadow: 0 4px 16px rgba(39, 145, 52, 0.3) !important;
        transition: all 0.3s ease !important;
    }
    
    .btn-gsr-accent:hover {
        box-shadow: 0 6px 20px rgba(39, 145, 52, 0.4) !important;
        transform: translateY(-1px) !important;
    }
    
    /* –£–ª—É—á—à–µ–Ω–Ω—ã–π –ª–æ–≥–æ—Ç–∏–ø GSR */
    .gsr-logo {
        height: 90px !important;
        width: 90px !important;
        border-radius: 50% !important;
        background: rgba(255, 255, 255, 0.15) !important;
        padding: 18px !important;
        box-shadow: 0 6px 20px rgba(255, 255, 255, 0.25) !important;
        transition: all 0.3s ease !important;
        border: 2px solid rgba(255, 255, 255, 0.3) !important;
        object-fit: contain !important;
    }
    
    .gsr-logo:hover {
        transform: scale(1.08) !important;
        box-shadow: 0 8px 25px rgba(255, 255, 255, 0.4) !important;
        border-color: rgba(255, 255, 255, 0.5) !important;
    }
    
    /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –ª–æ–≥–æ—Ç–∏–ø–∞ */
    .gsr-logo {
        animation: logoGlow 2s ease-in-out infinite alternate !important;
    }
    
    @keyframes logoGlow {
        0% { box-shadow: 0 6px 20px rgba(255, 255, 255, 0.25); }
        100% { box-shadow: 0 8px 25px rgba(255, 255, 255, 0.35); }
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è Excel-—Ç–∞–±–ª–∏—Ü—ã */
    .table-responsive {
        border: 1px solid #dee2e6;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .table thead th {
        background-color: #343a40 !important;
        color: white !important;
        border-color: #495057 !important;
        font-weight: 600;
        font-size: 13px;
        padding: 8px 12px;
    }
    
    .table tbody tr {
        transition: background-color 0.2s ease;
    }
    
    .table tbody tr:hover {
        background-color: #f8f9fa !important;
    }
    
    .table tbody td {
        padding: 8px 12px;
        vertical-align: middle;
        border-color: #dee2e6;
    }
    
    .form-check-input {
        margin: 0;
    }
</style>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card-gsr">
            <div class="card-body text-center gsr-bg-gradient text-white" style="border-radius: 16px 16px 0 0;">
                <img src="/static/7411193.png" alt="GSR" class="gsr-logo mb-3">
                <h1 class="gsr-heading mb-2">
                    <i class="fas fa-chart-line me-2"></i>–ú–æ–¥—É–ª—å –¢—Ä–µ–Ω–¥–≤–æ—Ç—á–∏–Ω–≥–∞
                </h1>
                <p class="mb-0 fs-5">–ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–æ–≤ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—É—Å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤</p>
                <a href="{{ url_for('settings_page', module_name='trends') }}" class="btn btn-outline-light btn-lg mt-3">
                    <i class="fas fa-cog me-2"></i>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ API
                </a>
            </div>
        </div>
    </div>
</div>

<div class="row step-container">
    <div class="col-12">
        <div class="card-gsr progress-step step-active" id="step1">
            <div class="d-flex align-items-center mb-4">
                <div class="step-number-gsr">1</div>
                <div class="flex-grow-1">
                    <div class="d-flex align-items-center mb-2">
                        <img src="/static/7411193.png" alt="GSR" class="gsr-logo me-3" style="height: 40px; width: 40px; border-radius: 50%; background: rgba(0, 64, 39, 0.1); padding: 8px;">
                        <h4 class="gsr-heading mb-0 gsr-text-primary">–°–±–æ—Ä —Ä–∏–ª—Å–æ–≤</h4>
                    </div>
                    <p class="text-muted mb-0">–£–∫–∞–∂–∏—Ç–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –∏ –ª–∏–º–∏—Ç, —á—Ç–æ–±—ã —Å–æ–±—Ä–∞—Ç—å —Å–≤–µ–∂–∏–µ —Ä–∏–ª—Å—ã</p>
                </div>
            </div>

            <div class="mb-4">
                <label for="reelsCount" class="form-label fw-bold gsr-text-secondary">
                    <i class="fas fa-hashtag me-2"></i>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∏–ª—Å–æ–≤ –Ω–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞
                </label>
                <select class="form-select form-select-lg" id="reelsCount" 
                        style="border: 2px solid rgba(0, 64, 39, 0.2); border-radius: 12px;">
                    <option value="10">10</option>
                    <option value="20" selected>20</option>
                    <option value="30">30</option>
                    <option value="50">50</option>
                </select>
            </div>
            
            <div class="mb-4">
                <label class="form-label fw-bold gsr-text-secondary">
                    <i class="fas fa-users me-2"></i>–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
                </label>
                <div id="competitorsList" class="p-3 border rounded bg-light" style="max-height: 200px; overflow-y: auto;">
                    <div class="text-center text-muted">
                        <div class="spinner-border spinner-border-sm" role="status"></div>
                        <div class="mt-2">–ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤‚Ä¶</div>
                    </div>
                </div>
                <div class="mt-2">
                    <button class="btn btn-sm btn-outline-primary" onclick="loadCompetitors()">
                        <i class="fas fa-refresh me-1"></i>–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫
                    </button>
                </div>
                <div class="mt-2">
                    <small class="text-muted">
                        <span id="competitorsCount">0</span> –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–æ
                    </small>
                </div>
                <div class="form-text mt-2">
                    <a href="{{ url_for('settings_page', module_name='trends') }}" class="link-success">
                        <i class="fas fa-cog me-1"></i>–î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
                    </a>
                </div>
            </div>

            <button class="btn btn-gsr-accent btn-lg" id="collectButton" onclick="collectReels(event)">
                <i class="fas fa-cloud-download-alt me-2"></i>–°–æ–±—Ä–∞—Ç—å —Ä–∏–ª—Å—ã –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
            </button>
            
            <div id="collectStatus" class="mt-3"></div>
        </div>
    </div>
</div>

<!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ —à–∞–≥–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
<div class="row step-container">
    <div class="col-12">
        <div class="card-gsr progress-step step-disabled" id="step2">
            <div class="d-flex align-items-center mb-4">
                <div class="step-number-gsr">2</div>
                <div>
                    <h4 class="gsr-heading mb-1 gsr-text-primary">–û—Ç–±–æ—Ä —Ä–∏–ª—Å–æ–≤</h4>
                    <p class="text-muted mb-0">–í—ã–±–µ—Ä–∏—Ç–µ –ª—É—á—à–∏–π —Ä–∏–ª—Å –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏</p>
                </div>
            </div>
            
            <div class="row g-3 mb-4">
                <div class="col-md-6">
                    <div class="d-flex align-items-center justify-content-between p-3 bg-light border rounded">
                        <span class="fw-bold">–í—Å–µ–≥–æ:</span>
                        <span class="badge bg-primary fs-6" id="totalReels">0</span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="d-flex align-items-center justify-content-between p-3 bg-light border rounded">
                        <span class="fw-bold">–í–∏—Ä–∞–ª—å–Ω—ã—Ö (>30k):</span>
                        <span class="badge bg-success fs-6" id="viralReels">0</span>
                    </div>
                </div>
            </div>
            
            <div class="d-flex gap-2 mb-3">
                <button class="btn btn-outline-primary" onclick="sortByViews()">
                    <i class="fas fa-eye me-1"></i>–ü—Ä–æ—Å–º–æ—Ç—Ä—ã
                </button>
                <button class="btn btn-outline-danger" onclick="sortByLikes()">
                    <i class="fas fa-heart me-1"></i>–õ–∞–π–∫–∏
                </button>
            </div>
            
            <div id="reelsList" class="row g-3">
                <div class="col-12 text-center text-muted p-4">
                    <i class="fas fa-video fa-2x mb-2"></i>
                    <div>–°–Ω–∞—á–∞–ª–∞ —Å–æ–±–µ—Ä–∏—Ç–µ —Ä–∏–ª—Å—ã –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤</div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}
