<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéµ Chrome Audio Player - CORS Fix</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .chrome-warning {
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        .chrome-warning h3 {
            color: #856404;
            margin-top: 0;
        }
        .audio-player {
            width: 100%;
            height: 80px;
            border-radius: 12px;
            background: #f8f9fa;
            border: 3px solid #e1e8ed;
            margin: 20px 0;
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 600;
        }
        .status.info { background: #d1ecf1; color: #0c5460; }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.warning { background: #fff3cd; color: #856404; }
        button {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px 5px;
        }
        button:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            margin: 15px 0;
            overflow-x: auto;
        }
        .solution-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin: 15px 0;
            border-left: 4px solid #e74c3c;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéµ Chrome Audio Player</h1>
        
        <div class="chrome-warning">
            <h3>‚ö†Ô∏è Chrome CORS –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ</h3>
            <p>Chrome –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∞—É–¥–∏–æ —Å localhost –∏–∑-–∑–∞ –ø–æ–ª–∏—Ç–∏–∫–∏ CORS. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–¥–∏–Ω –∏–∑ —Ä–µ—à–µ–Ω–∏–π –Ω–∏–∂–µ:</p>
        </div>
        
        <div class="solution-card">
            <h3>üîß –†–µ—à–µ–Ω–∏–µ 1: –ó–∞–ø—É—Å–∫ Chrome —Å –æ—Ç–∫–ª—é—á–µ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é</h3>
            <p>–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:</p>
            <div class="code-block">
open -a "Google Chrome" --args --disable-web-security --user-data-dir="/tmp/chrome_dev"
            </div>
            <button onclick="testChromeFix()">üß™ –¢–µ—Å—Ç –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–∫—Å–∞</button>
        </div>
        
        <div class="solution-card">
            <h3>üîß –†–µ—à–µ–Ω–∏–µ 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Safari</h3>
            <p>Safari –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å CORS –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –∫–æ—Ä–æ–±–∫–∏:</p>
            <button onclick="openInSafari()">ü¶Å –û—Ç–∫—Ä—ã—Ç—å –≤ Safari</button>
        </div>
        
        <div class="solution-card">
            <h3>üîß –†–µ—à–µ–Ω–∏–µ 3: –ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∞–π–ª</h3>
            <p>–û—Ç–∫—Ä–æ–π—Ç–µ –∞—É–¥–∏–æ —Ñ–∞–π–ª –Ω–∞–ø—Ä—è–º—É—é –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ:</p>
            <button onclick="testDirectLink()">üîó –¢–µ—Å—Ç –ø—Ä—è–º–æ–π —Å—Å—ã–ª–∫–∏</button>
            <div id="directLinkResult"></div>
        </div>
        
        <div class="solution-card">
            <h3>üéµ –¢–µ—Å—Ç –∞—É–¥–∏–æ –ø–ª–µ–µ—Ä–∞</h3>
            <button onclick="generateTestAudio()">üéµ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –∞—É–¥–∏–æ</button>
            <div id="generationStatus" class="status info" style="display: none;"></div>
            
            <audio id="chromePlayer" class="audio-player" controls>
                –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç.
            </audio>
            <div id="playerStatus" class="status info" style="display: none;"></div>
            
            <button onclick="playAudio()">‚ñ∂Ô∏è –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏</button>
            <button onclick="pauseAudio()">‚è∏Ô∏è –ü–∞—É–∑–∞</button>
            <button onclick="stopAudio()">‚èπÔ∏è –°—Ç–æ–ø</button>
        </div>
        
        <div class="solution-card">
            <h3>üìä –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h3>
            <button onclick="runDiagnostics()">üîç –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É</button>
            <div id="diagnostics" class="status info" style="display: none;"></div>
        </div>
    </div>

    <script>
        let currentAudioUrl = null;
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∞—É–¥–∏–æ
        async function generateTestAudio() {
            const status = document.getElementById('generationStatus');
            status.style.display = 'block';
            status.textContent = 'üéµ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ –∞—É–¥–∏–æ...';
            status.className = 'status info';
            
            try {
                const response = await fetch('/api/trends/generate-audio', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: "–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ —Ç–µ—Å—Ç –∞—É–¥–∏–æ –ø–ª–µ–µ—Ä–∞ –¥–ª—è Chrome —Å –æ–±—Ö–æ–¥–æ–º CORS –ø—Ä–æ–±–ª–µ–º.",
                        voice_id: "jP9L6ZC55cz5mmx4ZpCk",
                        model_id: "eleven_flash_v2_5",
                        speed: 1.0,
                        stability: 0.5,
                        similarity_boost: 0.5
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    status.textContent = '‚úÖ –ê—É–¥–∏–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ!';
                    status.className = 'status success';
                    currentAudioUrl = result.audio_url;
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤ –ø–ª–µ–µ—Ä
                    const player = document.getElementById('chromePlayer');
                    player.src = currentAudioUrl;
                    player.load();
                    
                    const playerStatus = document.getElementById('playerStatus');
                    playerStatus.style.display = 'block';
                    playerStatus.textContent = '‚úÖ –ê—É–¥–∏–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –≤ –ø–ª–µ–µ—Ä';
                    playerStatus.className = 'status success';
                    
                } else {
                    status.textContent = '‚ùå –û—à–∏–±–∫–∞: ' + result.message;
                    status.className = 'status error';
                }
                
            } catch (error) {
                status.textContent = '‚ùå –û—à–∏–±–∫–∞ CORS: ' + error.message;
                status.className = 'status error';
                console.error('CORS Error:', error);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è Chrome
                status.innerHTML = `
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <strong>Chrome –±–ª–æ–∫–∏—Ä—É–µ—Ç CORS –∑–∞–ø—Ä–æ—Å—ã!</strong><br>
                        –ó–∞–ø—É—Å—Ç–∏—Ç–µ Chrome —Å –æ—Ç–∫–ª—é—á–µ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é:<br>
                        <code style="background: #f8f9fa; padding: 8px; border-radius: 4px; display: block; margin: 10px 0;">
                            open -a "Google Chrome" --args --disable-web-security --user-data-dir="/tmp/chrome_dev"
                        </code>
                    </div>
                `;
            }
        }
        
        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∞—É–¥–∏–æ
        function playAudio() {
            const player = document.getElementById('chromePlayer');
            if (player.src) {
                player.play().then(() => {
                    const status = document.getElementById('playerStatus');
                    status.textContent = '‚ñ∂Ô∏è –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –Ω–∞—á–∞–ª–æ—Å—å';
                    status.className = 'status success';
                }).catch(e => {
                    const status = document.getElementById('playerStatus');
                    status.textContent = '‚ùå –û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è: ' + e.message;
                    status.className = 'status error';
                    console.error('Play error:', e);
                });
            } else {
                alert('–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∞—É–¥–∏–æ!');
            }
        }
        
        function pauseAudio() {
            const player = document.getElementById('chromePlayer');
            player.pause();
            const status = document.getElementById('playerStatus');
            status.textContent = '‚è∏Ô∏è –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ';
            status.className = 'status info';
        }
        
        function stopAudio() {
            const player = document.getElementById('chromePlayer');
            player.pause();
            player.currentTime = 0;
            const status = document.getElementById('playerStatus');
            status.textContent = '‚èπÔ∏è –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ';
            status.className = 'status info';
        }
        
        // –¢–µ—Å—Ç —Ñ–∏–∫—Å–∞ Chrome
        function testChromeFix() {
            alert('–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–∫—Å–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞!');
        }
        
        // –û—Ç–∫—Ä—ã—Ç–∏–µ –≤ Safari
        function openInSafari() {
            const currentUrl = window.location.href;
            const safariUrl = currentUrl.replace('localhost:8080', 'localhost:8080');
            window.open(safariUrl, '_blank');
        }
        
        // –¢–µ—Å—Ç –ø—Ä—è–º–æ–π —Å—Å—ã–ª–∫–∏
        function testDirectLink() {
            if (currentAudioUrl) {
                const directUrl = window.location.origin + currentAudioUrl;
                window.open(directUrl, '_blank');
                
                const result = document.getElementById('directLinkResult');
                result.innerHTML = `
                    <div class="status success">
                        ‚úÖ –ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞: <a href="${directUrl}" target="_blank">${directUrl}</a>
                    </div>
                `;
            } else {
                alert('–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∞—É–¥–∏–æ!');
            }
        }
        
        // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
        function runDiagnostics() {
            const diagnostics = document.getElementById('diagnostics');
            diagnostics.style.display = 'block';
            
            let report = '<h4>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç:</h4>';
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±—Ä–∞—É–∑–µ—Ä–∞
            const userAgent = navigator.userAgent;
            if (userAgent.includes('Chrome')) {
                report += '<p>‚úÖ –û–±–Ω–∞—Ä—É–∂–µ–Ω Google Chrome</p>';
            } else if (userAgent.includes('Safari')) {
                report += '<p>‚úÖ –û–±–Ω–∞—Ä—É–∂–µ–Ω Safari</p>';
            } else {
                report += '<p>‚ö†Ô∏è –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä</p>';
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∞—É–¥–∏–æ
            const audio = document.createElement('audio');
            if (audio.canPlayType) {
                report += '<p>‚úÖ HTML5 Audio –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è</p>';
            } else {
                report += '<p>‚ùå HTML5 Audio –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è</p>';
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ CORS
            report += '<p>üîç CORS: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∞—É–¥–∏–æ...</p>';
            
            diagnostics.innerHTML = report;
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –ø–ª–µ–µ—Ä–∞
        document.addEventListener('DOMContentLoaded', function() {
            const player = document.getElementById('chromePlayer');
            const status = document.getElementById('playerStatus');
            
            player.addEventListener('loadstart', () => {
                status.style.display = 'block';
                status.textContent = 'üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—á–∞–ª–∞—Å—å...';
                status.className = 'status info';
            });
            
            player.addEventListener('canplay', () => {
                status.textContent = '‚úÖ –ê—É–¥–∏–æ –≥–æ—Ç–æ–≤–æ –∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é';
                status.className = 'status success';
            });
            
            player.addEventListener('error', (e) => {
                status.textContent = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞—É–¥–∏–æ';
                status.className = 'status error';
                console.error('Player error:', e);
            });
        });
    </script>
</body>
</html>
