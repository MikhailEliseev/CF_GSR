#!/usr/bin/env python3
"""
–ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ CSV
"""

import requests
import json

def test_csv_upload():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É CSV"""
    print("üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É CSV...")
    
    try:
        # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π CSV —Ñ–∞–π–ª
        test_csv_content = """A,B,C,D,E,F,G,H,I
–î–æ–ª–∂–Ω–æ—Å—Ç—å:,–û–±—ä–µ–∫—Ç,–û–ø–ª–∞—Ç–∞,–£—Å–ª–æ–≤–∏—è,–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è,–ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å,–ú–µ–Ω–µ–¥–∂–µ—Ä,–Æ—Ä.–ª–∏—Ü–æ,–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
,–°–±–æ—Ä—â–∏–∫ –Ω–∞ –∫–æ–Ω–≤–µ–π–µ—Ä–µ,–õ–ì –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫—Å,320 —Ä—É–±/—á–∞—Å,—Å–º–µ–Ω–∞ - 11 —á–∞—Å–æ–≤,–û—Ç 18 –¥–æ 45 –ª–µ—Ç,15 –º—É–∂.,–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω –¢—Ä–µ–Ω–∏–Ω,–û–û–û –§–æ—Ä—Ç—Ä–µ–Ω–¥,–°–±–æ—Ä–∫–∞ –±—ã—Ç–æ–≤–æ–π —Ç–µ—Ö–Ω–∏–∫–∏
,–†–∞–±–æ—Ç–Ω–∏–∫ —Å–∫–ª–∞–¥–∞,–î–∂–∞–º–∏–ª—å–ö–æ,370 —Ä—É–±/—á–∞—Å,—Å–º–µ–Ω–∞ - 11 —á–∞—Å–æ–≤,–†–§/–†–ë,0,–í–∏–∫—Ç–æ—Ä –ì–æ—Ä—è–∏–Ω–æ–≤,–û–û–û –§–æ—Ä—Ç—Ä–µ–Ω–¥,–ë—Ä–µ–Ω–¥–æ–≤–∞—è –æ–¥–µ–∂–¥–∞"""
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
        with open("test_vacancies.csv", "w", encoding="utf-8") as f:
            f.write(test_csv_content)
        
        print("‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π CSV —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω")
        
        # –¢–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É
        with open("test_vacancies.csv", "rb") as f:
            files = {"file": ("test_vacancies.csv", f, "text/csv")}
            
            response = requests.post(
                "http://72.56.66.228/api/vacancies/upload-csv",
                files=files
            )
        
        print(f"–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: {response.status_code}")
        print(f"–û—Ç–≤–µ—Ç: {response.text[:500]}")
        
        if response.status_code == 200:
            data = response.json()
            if data.get("success"):
                print(f"‚úÖ CSV –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ! –ù–∞–π–¥–µ–Ω–æ {data.get('count', 0)} –≤–∞–∫–∞–Ω—Å–∏–π")
                return True
            else:
                print(f"‚ùå –û—à–∏–±–∫–∞: {data.get('error', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞')}")
                return False
        else:
            print(f"‚ùå HTTP –æ—à–∏–±–∫–∞: {response.status_code}")
            return False
            
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        return False

if __name__ == "__main__":
    success = test_csv_upload()
    if success:
        print("\nüéâ CSV –∑–∞–≥—Ä—É–∑–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç!")
        print("–ü—Ä–æ–±–ª–µ–º–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ frontend –∫–æ–¥–µ –∏–ª–∏ –≤ —Ç–æ–º, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∫–Ω–æ–ø–∫—É")
    else:
        print("\n‚ùå CSV –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç")
        print("–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –∏ endpoint")
