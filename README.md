# Контент Завод (Content Factory)

Автоматизированная платформа для создания видеороликов с говорящими головами на основе ИИ-технологий.

## 🚀 Возможности


### 🧱 Обновленная структура (октябрь 2025)
- \`app/\` — фабрика Flask-приложения и инициализация Socket.IO
- \`routes/\` — блюпринты HTTP-эндпоинтов (начиная с модуля трендов)
- \`services/\` — обертки над внешними API c фоллбэками без простоя
- \`modules/\` — бизнес-логика модулей, теперь использует слой сервисов
- \`tasks/\` — Celery-задачи, работающие через те же сервисы

### Модуль 1: Трендвотчинг
- Парсинг контента конкурентов через Apify
- Анализ виральности постов Instagram
- Автогенерация текстов на основе трендов
- Создание видеороликов с актуальным контентом

### Модуль 2: Вакансии  
- Синхронизация с Google Sheets
- Персонализированные тексты для каждой вакансии
- Массовая генерация видео-объявлений
- Привлекательная подача рабочих мест

### Модуль 3: Эксперты
- ИИ-генерация экспертных тем
- Настраиваемый портрет потребителя
- Создание обучающего контента
- Интерактивный выбор тем

## 🛠 Технологический стек

- **Backend**: Flask, SQLAlchemy, Celery
- **Database**: SQLite
- **Frontend**: Bootstrap 5, Socket.IO
- **APIs**: OpenAI, ElevenLabs, HeyGen, Apify
- **Cloud Storage**: Google Cloud Storage

## 📋 Требования

- Python 3.8+
- Redis (для Celery)
- Google Cloud Account (опционально, для облачного хранения)

## ⚙️ Установка

1. **Клонирование репозитория**
```bash
git clone [your-repo-url]
cd КЗ\ GSR
```

2. **Создание виртуального окружения**
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# или
venv\Scripts\activate  # Windows
```

3. **Установка зависимостей**
```bash
pip install -r requirements.txt
```

4. **Настройка переменных окружения**
Создайте файл `.env`:
```env
SECRET_KEY=your-secret-key
DATABASE_URL=sqlite:///content_factory.db
REDIS_URL=redis://localhost:6379/0

# Google Cloud (опционально)
GOOGLE_CLOUD_PROJECT=your-project-id
GOOGLE_CLOUD_BUCKET=your-bucket-name
GOOGLE_APPLICATION_CREDENTIALS=path/to/service-account.json
```

5. **Инициализация базы данных**
```bash
python -c "from app import create_app; from models import db; app, _ = create_app(); app.app_context().push(); db.create_all()"
```

6. **Быстрый бутстрап для модуля трендов (опционально)**
```bash
python scripts/bootstrap_trends_environment.py
```
> Скрипт создаст базовые настройки и несколько демо-конкурентов. Подробнее см. `docs/LOCAL_TRENDS_TEST.md`.

## 🚀 Запуск

### Рекомендуемый способ (Production и Development)

1. **Запуск через start.sh**
```bash
./start.sh
```

2. **ИЛИ запуск через run.py**
```bash
python run.py
```

- Это гарантирует автоматический запуск Redis, Celery и Flask-SocketIO.
- Приложение будет доступно по адресу: `http://localhost:5000`
- Используйте только эти способы запуска!

### Важно
- `app.py` теперь просто thin-обертка над `app_current_backup.py` (основная логика приложения).
- Не используйте для запуска файлы `real_app.py`, `simple_app.py`, `super_simple_app.py` — они устарели и оставлены только для истории.
- Все изменения делайте только в `app_current_backup.py`.
- Порт приложения всегда 5000 (не меняйте и не используйте автоматическую смену порта).

## 🔧 Настройка

### 1. API Ключи

Получите API ключи для следующих сервисов:

- **OpenAI**: https://platform.openai.com/api-keys
- **ElevenLabs**: https://beta.elevenlabs.io/speech-synthesis
- **HeyGen**: https://www.heygen.com/
- **Apify**: https://apify.com/

### 2. OpenAI Assistants

Создайте отдельных ассистентов для каждого модуля:

1. Перейдите в OpenAI Platform
2. Создайте новых ассистентов с соответствующими инструкциями
3. Скопируйте Assistant ID в настройки модулей

### 3. Google Sheets (для модуля вакансий)

1. Создайте таблицу с колонками:
   - Вакансия
   - Объект
   - Местонахождение
   - Оплата
   - Условия
   - Требования
   - Потребность
   - Комментарии

2. Сделайте таблицу публично доступной для чтения
3. Скопируйте URL в настройки модуля

### 4. Облачное хранилище (опционально)

Для Google Cloud Storage:
1. Создайте проект в GCP
2. Создайте bucket для хранения файлов
3. Создайте Service Account с правами на bucket
4. Скачайте JSON ключ и укажите путь в переменных окружения

## 📖 Использование

### Модуль Трендвотчинг

1. Добавьте конкурентов в настройках модуля
2. Настройте промпт для генерации текстов
3. Выберите голос и аватар по умолчанию
4. Запустите анализ трендов
5. Для локального прогона и проверки сервисов воспользуйтесь чеклистами `docs/LOCAL_TRENDS_TEST.md` и `docs/TRENDS_SERVICE_BEHAVIOR.md`.

### Модуль Вакансии

1. Настройте URL Google Sheets
2. Настройте промпт для вакансий
3. Выберите режим обработки (все/выборочно)
4. Запустите генерацию видео

### Модуль Эксперты

1. Настройте портрет потребителя
2. Настройте промпт для экспертного контента
3. Сгенерируйте темы с помощью ИИ
4. Выберите интересные темы и создайте видео

## 🔍 Мониторинг

Система включает в себя:
- Прогресс-бары в реальном времени
- WebSocket уведомления
- Логирование ошибок
- Статистика генераций

## 🛠 Устранение неполадок

### Проблемы с API

- Проверьте корректность API ключей
- Убедитесь в наличии средств на балансах
- Проверьте лимиты запросов

### Проблемы с Celery

- Убедитесь, что Redis запущен
- Проверьте подключение к Redis
- Перезапустите Celery worker

### Проблемы с базой данных

```bash
# Сброс базы данных
rm content_factory.db
python -c "from app import create_app; from models import db; app, _ = create_app(); app.app_context().push(); db.create_all()"
```

## 📊 Архитектура

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Flask App     │    │   Celery        │    │   Redis         │
│   (Web UI)      │◄──►│   (Background   │◄──►│   (Broker)      │
│                 │    │    Tasks)       │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       
         ▼                       ▼                       
┌─────────────────┐    ┌─────────────────────────────────────────┐
│   SQLite        │    │           External APIs                 │
│   (Settings &   │    │  ┌─────────┐ ┌─────────┐ ┌─────────┐   │
│    History)     │    │  │ OpenAI  │ │ElevenLabs│ │ HeyGen  │   │
└─────────────────┘    │  └─────────┘ └─────────┘ └─────────┘   │
                       │  ┌─────────┐ ┌─────────────────────┐   │
                       │  │  Apify  │ │ Google Cloud Storage│   │
                       │  └─────────┘ └─────────────────────┘   │
                       └─────────────────────────────────────────┘
```

## 🤝 Вклад в проект

1. Форкните репозиторий
2. Создайте ветку для новой функции
3. Внесите изменения
4. Добавьте тесты
5. Создайте Pull Request

## 📄 Лицензия

[Укажите лицензию]

## 📞 Поддержка

Для получения поддержки:
- Создайте Issue в GitHub
- Напишите на email: [your-email]

---

**Внимание**: Убедитесь, что у вас есть достаточные средства на балансах всех API сервисов перед началом использования.
# CF_GSR
