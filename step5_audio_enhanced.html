<!-- –®–∞–≥ 5: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—É–¥–∏–æ - –£–õ–£–ß–®–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø -->
<div class="row step-container">
    <div class="col-12">
        <div class="card-gsr progress-step step-disabled" id="step5">
            <div class="d-flex align-items-center mb-4">
                <div class="step-number-gsr">5</div>
                <div>
                    <h4 class="gsr-heading mb-1 gsr-text-primary">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—É–¥–∏–æ</h4>
                    <p class="text-muted mb-0">–°–æ–∑–¥–∞–π—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏</p>
                </div>
            </div>
            
            <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–æ–ª–æ—Å–∞ -->
            <div class="mb-4">
                <h5 class="gsr-text-primary mb-3">
                    <i class="fas fa-cog me-2"></i>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–æ–ª–æ—Å–∞
                </h5>
                
                <div class="row">
                    <!-- –ì–æ–ª–æ—Å -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">–ì–æ–ª–æ—Å</label>
                        <select class="form-select" id="voiceSelect">
                            <option value="jP9L6ZC55cz5mmx4ZpCk" selected>–ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫–∏–π –ê–ª–µ–∫—Å–µ–π</option>
                            <option value="demo_voice_1">–î–µ–º–æ-–≥–æ–ª–æ—Å 1</option>
                            <option value="demo_voice_2">–î–µ–º–æ-–≥–æ–ª–æ—Å 2</option>
                        </select>
                    </div>
                    
                    <!-- –ú–æ–¥–µ–ª—å -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">–ú–æ–¥–µ–ª—å</label>
                        <select class="form-select" id="modelSelect">
                            <option value="eleven_flash_v2_5" selected>Eleven Flash v2.5</option>
                            <option value="eleven_multilingual_v2">Eleven Multilingual v2</option>
                        </select>
                    </div>
                </div>
                
                <!-- –ü–æ–ª–∑—É–Ω–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label class="form-label">–°–∫–æ—Ä–æ—Å—Ç—å: <span id="speedValue">1.0</span></label>
                        <input type="range" class="form-range" id="speedSlider" 
                               min="0.5" max="2.0" step="0.1" value="1.0">
                    </div>
                    
                    <div class="col-md-4 mb-3">
                        <label class="form-label">–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å: <span id="stabilityValue">0.5</span></label>
                        <input type="range" class="form-range" id="stabilitySlider" 
                               min="0.0" max="1.0" step="0.1" value="0.5">
                    </div>
                    
                    <div class="col-md-4 mb-3">
                        <label class="form-label">–°—Ö–æ–∂–µ—Å—Ç—å: <span id="similarityValue">0.5</span></label>
                        <input type="range" class="form-range" id="similaritySlider" 
                               min="0.0" max="1.0" step="0.1" value="0.5">
                    </div>
                </div>
            </div>
            
            <!-- –ö–Ω–æ–ø–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ -->
            <button class="btn btn-gsr-accent btn-lg" onclick="generateAudioAdvanced()">
                <i class="fas fa-volume-up me-2"></i>–°–æ–∑–¥–∞—Ç—å –∞—É–¥–∏–æ
            </button>
            
            <!-- –°—Ç–∞—Ç—É—Å -->
            <div id="audioStatus" class="mt-3"></div>
            
            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
            <div id="audioResult" class="mt-4" style="display: none;">
                <h5 class="gsr-text-primary">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∞—É–¥–∏–æ:</h5>
                <audio controls class="w-100" id="audioPlayer">
                    <source id="audioSource" src="" type="audio/mpeg">
                    –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç.
                </audio>
            </div>
        </div>
    </div>
</div>

<script>
// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ–ª–∑—É–Ω–∫–æ–≤
document.getElementById('speedSlider').addEventListener('input', function() {
    document.getElementById('speedValue').textContent = this.value;
});

document.getElementById('stabilitySlider').addEventListener('input', function() {
    document.getElementById('stabilityValue').textContent = this.value;
});

document.getElementById('similaritySlider').addEventListener('input', function() {
    document.getElementById('similarityValue').textContent = this.value;
});

// –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∞—É–¥–∏–æ
async function generateAudioAdvanced() {
    console.log('üîä –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—É–¥–∏–æ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏...');
    const statusDiv = document.getElementById('audioStatus');
    const audioResult = document.getElementById('audioResult');
    const audioSource = document.getElementById('audioSource');
    const audioPlayer = document.getElementById('audioPlayer');
    
    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ —à–∞–≥–∞ 4
    const rewrittenText = document.getElementById('rewrittenText');
    if (!rewrittenText || !rewrittenText.textContent.trim()) {
        statusDiv.innerHTML = `
            <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle me-2"></i>
                –°–Ω–∞—á–∞–ª–∞ –ø–µ—Ä–µ–ø–∏—à–∏—Ç–µ —Ç–µ–∫—Å—Ç –Ω–∞ —à–∞–≥–µ 4
            </div>`;
        return;
    }
    
    const text = rewrittenText.textContent.trim();
    
    // –ü–æ–ª—É—á–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    const voiceId = document.getElementById('voiceSelect').value;
    const modelId = document.getElementById('modelSelect').value;
    const speed = parseFloat(document.getElementById('speedSlider').value);
    const stability = parseFloat(document.getElementById('stabilitySlider').value);
    const similarity = parseFloat(document.getElementById('similaritySlider').value);
    
    statusDiv.innerHTML = `
        <div class="alert alert-info">
            <i class="fas fa-spinner fa-spin me-2"></i>
            –°–æ–∑–¥–∞–µ–º –∞—É–¥–∏–æ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏: –≥–æ–ª–æ—Å=${voiceId}, –º–æ–¥–µ–ª—å=${modelId}, —Å–∫–æ—Ä–æ—Å—Ç—å=${speed}...
        </div>`;
    
    try {
        const response = await fetch('/api/trends/generate-audio', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                text: text,
                voice_id: voiceId,
                model_id: modelId,
                speed: speed,
                stability: stability,
                similarity_boost: similarity
            })
        });
        
        const result = await response.json();
        
        if (result.success) {
            statusDiv.innerHTML = `
                <div class="alert alert-success">
                    <i class="fas fa-check-circle me-2"></i>
                    –ê—É–¥–∏–æ —Å–æ–∑–¥–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ!
                </div>`;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            audioResult.style.display = 'block';
            audioSource.src = result.audio_url;
            audioPlayer.load(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –ø–ª–µ–µ—Ä
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥
            activateStep6();
        } else {
            statusDiv.innerHTML = `
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-circle me-2"></i>
                    –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: ${result.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}
                </div>`;
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∞—É–¥–∏–æ:', error);
        statusDiv.innerHTML = `
            <div class="alert alert-danger">
                <i class="fas fa-exclamation-circle me-2"></i>
                –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: ${error.message}
            </div>`;
    }
}
</script>
